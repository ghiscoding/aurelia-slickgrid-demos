"use strict";(self.webpackChunkau_slickgrid_demo=self.webpackChunkau_slickgrid_demo||[]).push([[3928],{3243:(e,t,s)=>{s.d(t,{L:()=>o,y:()=>l});var i=s(8696);function o(e,t,s){let o;s={modalType:"edit",validationFailedMsg:"Some of the fields have failed validation",validationMsgPrefix:null,show:null,hide:null,position:null,destroy:null,formValues:{},editors:{},...s};const a=()=>{},n=e=>{const s=t[e],{top:o,left:a}=(0,i.A3q)(s),n=s?.clientWidth??0,r=s?.clientHeight??0;return{top:o,left:a,bottom:o+r,right:a+n,width:n,height:r,visible:!0}};function r(r){const l=this;let d=[];l.getEditors=()=>d,l.destroy=()=>{let e=d.pop();for(;e;)e?.destroy(),e=d.pop();let o=t.pop();for(;o;)(0,i.i3Z)(o),o?.remove(),o=t.pop();s?.destroy?.(),d=[],t=null},l.focus=()=>{(o||d[0]).focus()},l.isValueChanged=()=>{let e=0;for(;e<d.length;){if(d[e].isValueChanged())return!0;e++}return!1},l.serializeValue=()=>{const e=[];let t=0;for(;t<d.length;)e[t]=d[t].serializeValue(),t++;return e},l.applyValue=(e,t)=>{let s=0;for(;s<d.length;)d[s].applyValue(e,t?.[s]),s++},l.loadValue=e=>{let t=0;for(;t<d.length;)d[t].loadValue(e),t++},l.validate=e=>{let i;o=null;const a=[];let n=0;for(;n<d.length;){const r=d[n].args?.column;if(void 0!==r?.id){const l=document.querySelector(".slick-editor-modal");let h=l?.querySelector(`.item-details-validation.editor-${r.id}`),c=l?.querySelector(`.item-details-label.editor-${r.id}`),u=l?.querySelector(`[data-editorid='${r.id}']`);const p=s?.validationMsgPrefix??"";e&&!u?.contains(e)||(i=d[n].validate(),i.valid?h&&(h.textContent="",u?.classList.remove("invalid"),c?.classList.remove("invalid")):(o=d[n],a.push({index:n,editor:d[n],container:t[n],msg:i.msg}),h&&(h.textContent=`${p}${i.msg}`,c?.classList.add("invalid"),u?.classList.add("invalid")))),h=null,c=null,u=null}n++}return e=null,a.length?{valid:!1,msg:s.validationFailedMsg,errors:a}:{valid:!0,msg:""}},l.hide=()=>{let e=0;for(;e<d.length;)d[e]?.hide?.(),e++;s?.hide?.()},l.show=()=>{let e=0;for(;e<d.length;)d[e]?.show?.(),e++;s?.show?.()},l.position=e=>{s?.position?.(e)},function(){let i={},o=0;for(;o<e.length;){if(e[o].editorClass){const l=e[o];i={...r},i.container=t[o],i.column=l,i.position=n(o),i.commitChanges=a,i.cancelChanges=a,i.compositeEditorOptions=s,i.formValues={};const h=new l.editorClass(i);s.editors[l.id]=h,d.push(h)}o++}window.setTimeout((()=>{Array.isArray(d)&&d.length>0&&"function"==typeof d[0].focus&&d[0].focus()}),0)}()}return r.prototype=this,r}var a=s(6221),n=s(1322);const r=e=>console.log(e.message);class l{get eventHandler(){return this._eventHandler}get dataView(){return this.grid?.getData()}get dataViewLength(){return this.dataView.getLength()}get formValues(){return this._formValues}get editors(){return this._editors}set editors(e){this._editors=e}get gridOptions(){return this.grid?.getOptions()}constructor(){this._columns=[],this._lastActiveRowNumber=-1,this._formValues=null,this._selectedRanges=[],this.gridService=null,this._eventHandler=new i.JD8,this._bindEventService=new a.P}init(e,t){if(this.grid=e,this.gridService=t.get("GridService"),this.translaterService=t.get("TranslaterService"),!this.gridService)throw new Error("[Slickgrid-Universal] it seems that the GridService is not being loaded properly, make sure the Container Service is properly implemented.");if(this.gridOptions.enableTranslate&&(!this.translaterService||!this.translaterService.translate))throw new Error('[Slickgrid-Universal] requires a Translate Service to be installed and configured when the grid option "enableTranslate" is enabled.');this._locales=this.gridOptions?.locales??i.YMJ.locales}dispose(){this.restoreSelectedRanges(),this._eventHandler.unsubscribeAll(),this._bindEventService.unbindAll(),this._formValues=null,"function"==typeof this._options?.onDispose&&this._options.onDispose(),this.disposeComponent()}disposeComponent(){this._modalBodyTopValidationElm?.remove(),this._modalSaveButtonElm?.remove(),"function"==typeof this._modalElm?.remove&&(this._modalElm.remove(),document.body.classList.remove("slick-modal-open")),this._editorContainers=[]}changeFormInputValue(e,t,s=!1,i=!0){const o=this.getColumnByObjectOrId(e),a="string"==typeof e?e:o?.id??"",r=this._editors?.[a];let l=t;if(!r&&!s)throw new Error(`Composite Editor with column id "${a}" not found.`);if("function"==typeof r?.setValue&&Array.isArray(this._editorContainers)){r.setValue(t,!0,i);const e=this._editorContainers.find((e=>e.dataset.editorid===a)),s=this.gridOptions?.compositeEditorOptions?.excludeDisabledFieldFormValues??!1;!r.disabled||r.disabled&&!s?e?.classList?.add("modified"):(l="",e?.classList?.remove("modified")),!r.disabled||""===l&&null===l&&void 0===l&&0===l||(l="")}const d=o?.field??"";if(o&&d?.includes(".")){const e=o.editor?.complexObjectPath??d??"";(0,n.setDeepValue)(this._formValues??{},e,t)}else this._formValues={...this._formValues,[a]:l}}changeFormValue(e,t){const s=this.getColumnByObjectOrId(e),i="string"==typeof e?e:s?.id??"",o=s?.field??e;if(o?.includes(".")){const e=s?.editor?.complexObjectPath??o??"";(0,n.setDeepValue)(this._formValues,e,t)}else this._formValues={...this._formValues,[i]:t};this._formValues=(0,n.deepMerge)({},this._itemDataContext,this._formValues)}changeFormEditorOption(e,t,s){const i=this._editors?.[e];if(!i?.changeEditorOption)throw new Error(`Editor with column id "${e}" not found OR the Editor does not support "changeEditorOption" (current only available with Date, MultipleSelect, SingleSelect & Slider Editors).`);i.changeEditorOption(t,s)}disableFormInput(e,t=!0){const s=this._editors?.[e];s?.disable&&Array.isArray(this._editorContainers)&&s.disable(t)}openDetails(e){const t=e.onError??r,s={backdrop:"static",showCloseButtonOutside:!0,shouldClearRowSelectionAfterMassAction:!0,viewColumnLayout:"auto",modalType:"edit"};try{if(!this.grid||this.grid.getEditorLock().isActive()&&!this.grid.getEditorLock().commitCurrentEdit())return null;this._formValues=null,this._options={...s,...this.gridOptions.compositeEditorOptions,...e,labels:{...this.gridOptions.compositeEditorOptions?.labels,...e?.labels}},this._options.backdrop=void 0!==e.backdrop?e.backdrop:"static";const a=this._options.viewColumnLayout||1,r=this.grid.getActiveCell(),l=r?.cell??0,d=r?.row??0,h=this.grid.getUID()||"";let c=e.headerTitle||"";"function"==typeof this._options.onBeforeOpen&&this._options.onBeforeOpen(),this.hasRowSelectionEnabled()&&"auto-mass"===this._options.modalType&&this.grid.getSelectedRows&&((this.grid.getSelectedRows()||[]).length>0?(this._options.modalType="mass-selection",e?.headerTitleMassSelection&&(c=e?.headerTitleMassSelection)):(this._options.modalType="mass-update",e?.headerTitleMassUpdate&&(c=e?.headerTitleMassUpdate)));const u=this._options.modalType||"edit";if(!this.gridOptions.editable)return t({type:"error",code:"EDITABLE_GRID_REQUIRED",message:"Your grid must be editable in order to use the Composite Editor Modal."}),null;if(!this.gridOptions.enableCellNavigation)return t({type:"error",code:"ENABLE_CELL_NAVIGATION_REQUIRED",message:'Composite Editor requires the flag "enableCellNavigation" to be set to True in your Grid Options.'}),null;if(!(this.gridOptions.enableAddRow||"clone"!==u&&"create"!==u))return t({type:"error",code:"ENABLE_ADD_ROW_REQUIRED",message:'Composite Editor requires the flag "enableAddRow" to be set to True in your Grid Options when cloning/creating a new item.'}),null;if(!(r||"clone"!==u&&"edit"!==u))return t({type:"warning",code:"NO_RECORD_FOUND",message:"No records selected for edit or clone operation."}),null;{const e="mass-update"===u||"mass-selection"===u,s=e?{}:this.grid.getDataItem(d);this._originalDataContext=(0,n.deepCopy)(s),this._columns=this.grid.getColumns();const r=this.hasRowSelectionEnabled()?this.grid.getSelectedRows():[],p=this.dataView?.getItemCount()??0;this._lastActiveRowNumber=d;const m=this.dataView.getAllSelectedIds();this._selectedRanges=this.grid.getSelectionModel()?.getSelectedRanges()||[];const g="create"===u?this.dataViewLength:d;if(!this.focusOnFirstColumnCellWithEditor(this._columns,s,l,g,e))return null;if(this.restoreSelectedRanges(),"edit"===u&&!s)return t({type:"warning",code:"ROW_NOT_EDITABLE",message:"Current row is not editable."}),null;if("mass-selection"===u&&r.length<1)return t({type:"warning",code:"ROW_SELECTION_REQUIRED",message:"You must select some rows before trying to apply new value(s)."}),null;let f=[];f=e?this._columns.filter((e=>e.editorClass&&!0===e.editor?.massUpdate)):this._columns.filter((e=>e.editorClass)),f.some((e=>void 0!==e.editor?.compositeEditorFormOrder))&&f.sort(((e,t)=>{const s=e?.editor?.compositeEditorFormOrder??1/0,o=t?.editor?.compositeEditorFormOrder??1/0;return(0,i.JXN)(s,o,i.Lo1.asc)}));const C=c.replace(/\{\{(.*?)\}\}/g,((e,t)=>(0,i.njg)(s,t))),b="auto"===a?this.autoCalculateLayoutColumnCount(f.length):a;this._modalElm=(0,i.fhB)("div",{className:`slick-editor-modal ${h}`});const y=(0,i.fhB)("div",{className:"slick-editor-modal-content"});if(this.gridOptions?.darkMode&&y.classList.add("slick-dark-mode"),!isNaN(a)&&+a>1||"auto"===a&&b>1){const e=2===b?"split-view":"triple-split-view";y.classList.add(e)}const v=(0,i.fhB)("div",{className:"slick-editor-modal-title"});this.grid.applyHtmlCode(v,C);const E=(0,i.fhB)("button",{type:"button",ariaLabel:"Close",textContent:"Ã—",className:"close",dataset:{action:"close"}});this._options.showCloseButtonOutside&&(v?.classList?.add("outside"),E?.classList?.add("outside"));const _=(0,i.fhB)("div",{ariaLabel:"Close",className:"slick-editor-modal-header"});_.appendChild(v),_.appendChild(E);const w=(0,i.fhB)("div",{className:"slick-editor-modal-body"});this._modalBodyTopValidationElm=(0,i.fhB)("div",{className:"validation-summary",style:{display:"none"}},w);const S=(0,i.fhB)("div",{className:"slick-editor-modal-footer"}),R=(0,i.fhB)("button",{type:"button",ariaLabel:this.getLabelText("cancelButton","TEXT_CANCEL","Cancel"),className:"btn btn-cancel btn-default btn-sm",textContent:this.getLabelText("cancelButton","TEXT_CANCEL","Cancel"),dataset:{action:"cancel"}});let T="",O="";switch(u){case"clone":O=this.getLabelText("cloneButton","TEXT_CLONE","Clone");break;case"mass-update":const e=this.getLabelText("massUpdateStatus","TEXT_ALL_X_RECORDS_SELECTED","All {{x}} records selected");T=this.parseText(e,{x:p}),O=this.getLabelText("massUpdateButton","TEXT_APPLY_MASS_UPDATE","Mass Update");break;case"mass-selection":const t=this.getLabelText("massSelectionStatus","TEXT_X_OF_Y_MASS_SELECTED","{{x}} of {{y}} selected");T=this.parseText(t,{x:m.length,y:p}),O=this.getLabelText("massSelectionButton","TEXT_APPLY_TO_SELECTION","Update Selection");break;default:O=this.getLabelText("saveButton","TEXT_SAVE","Save")}const k=(0,i.fhB)("div",{className:"footer-status-text",textContent:T});this._modalSaveButtonElm=(0,i.fhB)("button",{type:"button",className:"btn btn-save btn-primary btn-sm",ariaLabel:O,textContent:O,dataset:{action:"create"===u||"edit"===u?"save":u,ariaLabel:O}});const I=(0,i.fhB)("div",{className:"footer-buttons"});"mass-update"!==u&&"mass-selection"!==u||S.appendChild(k),I.appendChild(R),I.appendChild(this._modalSaveButtonElm),S.appendChild(I),y.appendChild(_),y.appendChild(w),y.appendChild(S),this._modalElm.appendChild(y);for(const e of f)if(e.editorClass){const t=(0,i.fhB)("div",{className:`item-details-container editor-${e.id}`});1===b?t.classList.add("slick-col-medium-12"):t.classList.add("slick-col-medium-6","slick-col-xlarge-"+12/b);const s=(0,i.fhB)("div",{className:`item-details-label editor-${e.id}`});this.grid.applyHtmlCode(s,this.getColumnLabel(e)||"n/a");const o=(0,i.fhB)("div",{className:"item-details-editor-container slick-cell",dataset:{editorid:`${e.id}`}}),a=(0,i.fhB)("div",{className:`item-details-validation editor-${e.id}`});if(this._options?.showResetButtonOnEachEditor){const t=this.createEditorResetButtonElement(`${e.id}`);this._bindEventService.bind(t,"click",this.handleResetInputValue.bind(this)),s.appendChild(t)}t.appendChild(s),t.appendChild(o),t.appendChild(a),w.appendChild(t)}if(this._options?.showFormResetButton){const e=this.createFormResetButtonElement();this._bindEventService.bind(e,"click",this.handleResetFormClicked.bind(this)),w.appendChild(e)}document.body.appendChild(this._modalElm),document.body.classList.add("slick-modal-open"),this._bindEventService.bind(document.body,"click",this.handleBodyClicked.bind(this)),"function"==typeof this._options.onRendered&&this._options.onRendered(this._modalElm),this._editors={},this._editorContainers=f.map((e=>w.querySelector(`[data-editorid='${e.id}']`)))||[],this._compositeOptions={destroy:this.disposeComponent.bind(this),modalType:u,validationMsgPrefix:"* ",formValues:{},editors:this._editors};const x=new o(f,this._editorContainers,this._compositeOptions);this.grid.editActiveCell(x),this._bindEventService.bind(E,"click",this.cancelEditing.bind(this)),this._bindEventService.bind(R,"click",this.cancelEditing.bind(this)),this._bindEventService.bind(this._modalSaveButtonElm,"click",this.handleSaveClicked.bind(this)),this._bindEventService.bind(this._modalElm,"keydown",this.handleKeyDown.bind(this)),this._bindEventService.bind(this._modalElm,"focusout",this.validateCurrentEditor.bind(this)),this._bindEventService.bind(this._modalElm,"blur",this.validateCurrentEditor.bind(this)),this._eventHandler.subscribe(this.grid.onCompositeEditorChange,this.handleOnCompositeEditorChange.bind(this)),this._eventHandler.subscribe(this.grid.onAddNewRow,((e,t)=>{this._originalDataContext=this.insertNewItemInDataView(t.item)}))}return this}catch(e){this.dispose();const s="string"==typeof e?e:e?.message??e?.body?.message??"";return t({type:"error",code:"string"==typeof e?e:e?.status??e?.body?.status??s,message:s}),null}}async cancelEditing(){let e=!0;this.formValues&&Object.keys(this.formValues).length>0&&"function"==typeof this._options.onClose&&(e=await this._options.onClose()),e&&(this.grid.getEditController()?.cancelCurrentEdit(),"edit"!==this._options?.modalType&&"clone"!==this._options?.modalType||this.resetCurrentRowDataContext(),this.grid.setActiveRow(this._lastActiveRowNumber),this.dispose())}showValidationSummaryText(e,t=""){e&&""!==t?(this._modalBodyTopValidationElm.textContent=t,this._modalBodyTopValidationElm.style.display="block",this._modalBodyTopValidationElm.scrollIntoView?.(),this._modalSaveButtonElm.disabled=!1,this._modalSaveButtonElm.classList.remove("saving")):(this._modalBodyTopValidationElm.style.display="none",this._modalBodyTopValidationElm.textContent=t)}restoreSelectedRanges(){const e="mass-update"===this._options?.modalType?[]:this._selectedRanges;this.grid.getSelectionModel()?.setSelectedRanges(e)}applySaveMassUpdateChanges(e,t,s=!0){const i=s?this.dataView.getItems():(0,n.deepCopy)(this.dataView.getItems());return Object.keys(e).forEach((t=>{t in e&&i.forEach((s=>{!(t in e)||void 0!==this._options?.validateMassUpdateChange&&!1===this._options.validateMassUpdateChange(t,s,e)||(s[t]=e[t])}))})),s&&(this.dataView.setItems(i,this.gridOptions.datasetIdPropertyName),this.grid.invalidate()),i}applySaveMassSelectionChanges(e,t,s=!0){const i=(t?.dataContextIds??[]).map((e=>this.dataView.getItemById(e))),o=s?i:(0,n.deepCopy)(i);return Object.keys(e).forEach((t=>{t in e&&o.forEach((s=>{!(t in e)||void 0!==this._options?.validateMassUpdateChange&&!1===this._options.validateMassUpdateChange(t,s,e)||(s[t]=e[t])}))})),s&&this.gridService?.updateItems(o),o}autoCalculateLayoutColumnCount(e){return e>=15?3:e>=8?2:1}createEditorResetButtonElement(e){const t=(0,i.fhB)("button",{type:"button",name:e,ariaLabel:"Reset",title:this._options?.labels?.resetFormButton??"Reset Form Input",className:"btn btn-xs btn-editor-reset"});if(this._options?.resetEditorButtonCssClass){const e=(0,n.classNameToList)(this._options?.resetEditorButtonCssClass);for(const s of e)t.classList.add(s)}return t}createFormResetButtonElement(){const e=(0,i.fhB)("div",{className:"reset-container"}),t=(0,i.fhB)("button",{type:"button",className:"btn btn-sm reset-form"},e);return(0,i.fhB)("span",{className:this._options?.resetFormButtonIconCssClass??""},t),t.appendChild(document.createTextNode(" Reset Form")),e}executeOnError(e){(this._options?.onError??r)(e)}async executeOnSave(e,t,s,i){try{if(this.showValidationSummaryText(!1,""),this.validateCompositeEditors().valid){if(this._modalSaveButtonElm.classList.add("saving"),this._modalSaveButtonElm.disabled=!0,"function"==typeof this._options?.onSave){const s="mass-update"===this._options.modalType||"mass-selection"===this._options.modalType;let o;s&&this._options?.shouldPreviewMassChangeDataset&&(o=e(this.formValues,this.getCurrentRowSelections(),!1));const a=s?o:i;await(this._options?.onSave(this.formValues,this.getCurrentRowSelections(),a))&&(e(this.formValues,this.getCurrentRowSelections()),t())}else e(this.formValues,this.getCurrentRowSelections()),t();"function"==typeof s&&s(),this.dispose()}}catch(e){const t="string"==typeof e?e:e?.message??e?.body?.message??"";this.showValidationSummaryText(!0,t)}}focusOnFirstColumnCellWithEditor(e,t,s,i,o){const a=o&&!this.gridOptions.enableAddRow&&i>=this.dataViewLength?this.dataViewLength-1:i;let n=s;const r=e[s].editorClass;let l=this.grid.getCellNode(a,s);if(!r||!l||!this.getActiveCellEditor(a,s)){if(n=this.findNextAvailableEditorColumnIndex(e,t,i,o),-1===n)return this.executeOnError({type:"error",code:"NO_EDITOR_FOUND",message:"We could not find any Editor in your Column Definition"}),!1;this.grid.setActiveCell(a,n,!1),o&&this.grid.setActiveRow(this.dataViewLength,n,!0)}return l=this.grid.getCellNode(a,n),!!l}findNextAvailableEditorColumnIndex(e,t,s,i){let o=-1;for(let a=0;a<e.length;a++){const n=e[a];if(n.editorClass&&(!i||i&&n.editor?.massUpdate)){const e=this.grid.onBeforeEditCell.notify({row:s,cell:a,item:t,column:n,grid:this.grid,target:"composite",compositeEditorOptions:this._compositeOptions}).getReturnValue();if(this.grid.setActiveCell(s,a,!1),!1!==e){o=a;break}}}return o}getColumnByObjectOrId(e){let t;return"object"==typeof e?t=e:"string"==typeof e&&(t=this._columns.find((t=>t.id===e))),t}getActiveCellEditor(e,t){return this.grid.setActiveCell(e,t,!1),this.grid.getCellEditor()}getColumnLabel(e){const t=this.gridOptions.columnGroupSeparator||" - ";let s=e.nameCompositeEditor||e.name||"",i=e.columnGroup||"";if(this.gridOptions.enableTranslate&&this.translaterService){const t=e.nameCompositeEditorKey||e.nameKey;t&&(s=this.translaterService.translate(t)),e.columnGroupKey&&this.translaterService?.translate&&(i=this.translaterService.translate(e.columnGroupKey))}const o=i?`${i}${t}${s}`:s;return(0,n.getHtmlStringOutput)(o,"innerHTML")}getLabelText(e,t,s){const i={...this.gridOptions.compositeEditorOptions?.labels,...this._options?.labels};if(this.gridOptions?.enableTranslate&&this.translaterService?.translate&&i.hasOwnProperty(`${e}Key`)){const t=i[`${e}Key`];return this.translaterService.translate(t||"")}return i?.[e]??this._locales?.[t]??s}getCurrentRowSelections(){const e=this.dataView.getAllSelectedIds();return{gridRowIndexes:this.dataView.mapIdsToRows(e),dataContextIds:e}}handleBodyClicked(e){e.target?.classList?.contains("slick-editor-modal")&&"static"!==this._options?.backdrop&&this.dispose()}handleKeyDown(e){"Escape"===e.code?(this.cancelEditing(),e.stopPropagation(),e.preventDefault()):"Tab"===e.code&&this.validateCurrentEditor()}handleResetInputValue(e){const t=e.target.name,s=this._editors?.[t];"function"==typeof s?.reset&&s.reset(),delete this._formValues?.[t]}async handleMassSaving(e,t){if(this.formValues&&0!==Object.keys(this.formValues).length){const s="mass-update"===e?"applySaveMassUpdateChanges":"applySaveMassSelectionChanges";this.executeOnSave(this[s].bind(this),t.bind(this))}else this.executeOnError({type:"warning",code:"NO_CHANGES_DETECTED",message:"Sorry we could not detect any changes."})}handleOnCompositeEditorChange(e,t){const s=t.column?.id??"";this._formValues={...this._formValues,...t.formValues};const i=this._editors?.[s],o=i?.isValueTouched?.()??i?.isValueChanged?.()??!1;this._itemDataContext=i?.dataContext??{};const a=this._modalElm.querySelector(`[data-editorid='${s}']`);a?.classList&&a.classList.toggle("modified",o),this.validateCompositeEditors()}hasRowSelectionEnabled(){return!!this.grid.getSelectionModel()}handleResetFormClicked(){for(const e of Object.keys(this._editors)){const t=this._editors[e];t?.reset&&t.reset()}this._formValues=(0,n.emptyObject)(this._formValues)}async handleSaveClicked(){const e=this._options?.modalType;switch(e){case"mass-update":this.handleMassSaving(e,(()=>{this.grid.getEditController()?.cancelCurrentEdit(),this.grid.setActiveCell(0,0,!1),this._options.shouldClearRowSelectionAfterMassAction&&this.grid.setSelectedRows([])}));break;case"mass-selection":this.handleMassSaving(e,(()=>{this.grid.getEditController()?.cancelCurrentEdit(),this.grid.setActiveRow(this._lastActiveRowNumber),this._options.shouldClearRowSelectionAfterMassAction&&this.grid.setSelectedRows([])}));break;case"clone":const t={...this._originalDataContext,...this.formValues},s=()=>{this.grid.getEditController()?.cancelCurrentEdit(),this.grid.setActiveCell(0,0,!1)};this.executeOnSave(this.insertNewItemInDataView.bind(this,t),s,this.resetCurrentRowDataContext.bind(this),t);break;default:let i=this.grid.getEditController()?.commitCurrentEdit();if(i&&"function"==typeof this._options?.onSave){const t="create"===e?this._originalDataContext:this.grid.getDataItem(this._lastActiveRowNumber);i=await(this._options?.onSave(this.formValues,this.getCurrentRowSelections(),t))}i&&this.dispose()}}insertNewItemInDataView(e){const t=this.dataView?.getItemCount()||0,s=this._options.insertNewId??t+1;return e[this.gridOptions.datasetIdPropertyName||"id"]=s,this.dataView.getItemById(s)?this.executeOnError({type:"error",code:"ITEM_ALREADY_EXIST",message:`The item object which you are trying to add already exist with the same Id:: ${s}`}):this.gridService?.addItem(e,this._options.insertOptions),e}parseText(e,t){return e.replace(/\{\{(.*?)\}\}/g,((e,s)=>void 0!==t[s]?t[s]:e))}resetCurrentRowDataContext(){const e=this.gridOptions.datasetIdPropertyName||"id";this.grid.getData().updateItem(this._originalDataContext[e],this._originalDataContext)}validateCompositeEditors(e){let t={valid:!0,msg:""};const s=this.grid.getCellEditor();return s&&(t=s.validate(e)),t}validateCurrentEditor(){const e=this.grid.getCellEditor();e?.validate&&e.validate()}}},8880:(e,t,s)=>{s.d(t,{Pq:()=>o,xl:()=>u});var i=s(7557);function o(e,t){return JSON.stringify(void 0!==e?e:{},t)}class a{constructor(){this.cache=new Map,this.delete=e=>this.cache.delete(e),this.has=e=>this.cache.has(e),this.set=(e,t)=>this.cache.set(e,t),this.get=e=>this.cache.get(e),this.clear=()=>this.cache.clear()}}const n=i.DI.createInterface((e=>e.singleton(a)));class r{constructor(){this.baseUrl="",this.defaults={},this.interceptors=[],this.dispatcher=null,this.c=(0,i.hd)(i.p7)}withBaseUrl(e){return this.baseUrl=e,this}withDefaults(e){return this.defaults=e,this}withInterceptor(e){return this.interceptors.push(e),this}useStandardConfiguration(){return Object.assign(this.defaults,{credentials:"same-origin"},this.defaults),this.rejectErrorResponses()}rejectErrorResponses(){return this.withInterceptor({response:l})}withRetry(e){const t=this.c.invoke(O,[e]);return this.withInterceptor(t)}withDispatcher(e){return this.dispatcher=e,this}}function l(e){if(!e.ok)throw e;return e}const d=(e,...t)=>new Error(`AUR${String(e).padStart(4,"0")}:${t.map(String)}`),h=/^([a-z][a-z0-9+\-.]*:)?\/\//i,c=i.DI.createInterface("fetch",(e=>{if("function"!=typeof fetch)throw d(5e3);return e.instance(fetch)})),u=i.DI.createInterface("IHttpClient",(e=>e.aliasTo(p)));class p{constructor(){this.activeRequestCount=0,this.isRequesting=!1,this.isConfigured=!1,this.baseUrl="",this.defaults=null,this.t=[],this.i=null,this.h=(0,i.hd)((0,i.P9)(r)),this.u=(0,i.hd)(c)}get interceptors(){return this.t.slice(0)}configure(e){let t;if("object"==typeof e)t={defaults:e};else{if("function"!=typeof e)throw d(5002,typeof e);{t=this.h(),t.baseUrl=this.baseUrl,t.defaults={...this.defaults},t.interceptors=this.t,t.dispatcher=this.i;const s=e(t);if(null!=s){if("object"!=typeof s)throw d(5001,typeof s);t=s}}}const s=t.defaults;if(s?.headers instanceof Headers)throw d(5003);const i=t.interceptors;if(i?.length>0){if(i.filter((e=>e instanceof O)).length>1)throw d(5004);const e=i.findIndex((e=>e instanceof O));if(e>=0&&e!==i.length-1)throw d(5005)}return this.baseUrl=t.baseUrl,this.defaults=s,this.t=t.interceptors??[],this.i=t.dispatcher,this.isConfigured=!0,this}fetch(e,t){this.C();let s=this.buildRequest(e,t);return this.processRequest(s,this.t).then((e=>{let t;if(e instanceof Response)t=Promise.resolve(e);else{if(!(e instanceof Request))throw d(5006,e);s=e,t=this.u.call(void 0,s)}return this.processResponse(t,this.t,s)})).then((e=>e instanceof Request?this.fetch(e):e)).then((e=>(this.R(),e)),(e=>{throw this.R(),e}))}buildRequest(e,t){const s=this.defaults??{};let i,o,a;const n=function(e){const t={},s=e??{};for(const e of Object.keys(s))t[e]="function"==typeof s[e]?s[e]():s[e];return t}(s.headers);if(e instanceof Request)i=e,a=new Headers(i.headers).get("Content-Type");else{t||(t={}),o=t.body;const n=void 0!==o?{body:o}:null,r={...s,headers:{},...t,...n};a=new Headers(r.headers).get("Content-Type"),i=new Request(m(this.baseUrl,e),r)}return a||(new Headers(n).has("content-type")?i.headers.set("Content-Type",new Headers(n).get("content-type")):void 0!==o&&function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(o)&&i.headers.set("Content-Type","application/json")),function(e,t){const s=t??{};for(const t of Object.keys(s))e.has(t)||e.set(t,s[t])}(i.headers,n),o instanceof Blob&&o.type&&i.headers.set("Content-Type",o.type),i}get(e,t){return this.fetch(e,t)}post(e,t,s){return this.I(e,t,s,"POST")}put(e,t,s){return this.I(e,t,s,"PUT")}patch(e,t,s){return this.I(e,t,s,"PATCH")}delete(e,t,s){return this.I(e,t,s,"DELETE")}dispose(){this.t.forEach((e=>e.dispose?.())),this.t.length=0,this.i=null}C(){this.isRequesting=!!++this.activeRequestCount,this.isRequesting&&null!=this.i&&C(this.i,b.started)}R(){this.isRequesting=!! --this.activeRequestCount,this.isRequesting||null==this.i||C(this.i,b.drained)}processRequest(e,t){return this.B(e,t,"request","requestError",Request,this)}processResponse(e,t,s){return this.B(e,t,"response","responseError",Response,s,this)}B(e,t,s,i,o,...a){return(t??[]).reduce(((e,t)=>{const n=t[s],r=t[i];return e.then(n?e=>e instanceof o?n.call(t,e,...a):e:g,r?e=>r.call(t,e,...a):f)}),Promise.resolve(e))}I(e,t,s,i){return s||(s={}),s.method=i,null!=t&&(s.body=t),this.fetch(e,s)}}function m(e,t){return h.test(t)?t:(e??"")+t}function g(e){return e}function f(e){throw e}function C(e,t){const s=new e.ownerDocument.defaultView.CustomEvent(t,{bubbles:!0,cancelable:!0});setTimeout((()=>{e.dispatchEvent(s)}),1)}const b=Object.freeze({started:"aurelia-fetch-client-request-started",drained:"aurelia-fetch-client-requests-drained"}),y=i.DI.createInterface((e=>e.singleton(E))),v=Object.freeze({Set:"au:fetch:cache:set",Get:"au:fetch:cache:get",Clear:"au:fetch:cache:clear",Reset:"au:fetch:cache:reset",Dispose:"au:fetch:cache:dispose",CacheHit:"au:fetch:cache:hit",CacheMiss:"au:fetch:cache:miss",CacheStale:"au:fetch:cache:stale",CacheStaleRefreshed:"au:fetch:cache:stale:refreshed",CacheExpired:"au:fetch:cache:expired",CacheBackgroundRefreshed:"au:fetch:cache:background:refreshed",CacheBackgroundRefreshing:"au:fetch:cache:background:refreshing",CacheBackgroundStopped:"au:fetch:cache:background:stopped"});class E{constructor(){this.storage=(0,i.hd)(n),this.p=(0,i.hd)(i.r_),this.ea=(0,i.hd)(i.xe),this.q=(0,i.hd)(u),this.H=[],this.O=-1,this.j=[],this.T=new Map}subscribe(e,t){const s=this.ea.subscribe(e,t);return this.H.push(s),s}subscribeOnce(e,t){const s=this.ea.subscribeOnce(e,t);return this.H.push(s),s}setStaleTimer(e,t,s){const i=this.p.setTimeout((async()=>{this.delete(e),await this.q.get(s);const t=this.getItem(e);this.ea.publish(v.CacheStaleRefreshed,{key:e,value:t}),this.N(i)}),t);this.j.push(i)}startBackgroundRefresh(e){!e||this.O>-1||(this.O=this.p.setInterval((()=>{this.ea.publish(v.CacheBackgroundRefreshing),this.T.forEach(((e,t)=>{this.delete(t),this.q.get(e).then((()=>{const e=this.getItem(t);this.ea.publish(v.CacheBackgroundRefreshed,{key:t,value:e})}))}))}),e))}stopBackgroundRefresh(){this.p.clearInterval(this.O),this.O=-1,this.ea.publish(v.CacheBackgroundStopped)}set(e,t,s,i){const o={data:t,...s};this.setItem(e,o,i)}get(e){return this.getItem(e)?.data}setItem(e,t,s){t.lastCached=Date.now(),this.storage.set(e,t),this.T.set(e,s),this.ea.publish(v.Set,{key:e,value:t})}getItem(e){if(!this.storage.has(e))return void this.ea.publish(v.CacheMiss,{key:e});const t=this.storage.get(e);if(!t?.staleTime||!t?.lastCached)return this.ea.publish(v.CacheHit,{key:e,value:t}),t;const s=Date.now();if(s>t.lastCached+(t.staleTime??0))this.ea.publish(v.CacheStale,{key:e,value:t});else{if(!(s>t.lastCached+(t.cacheTime??0)))return this.ea.publish(v.CacheHit,{key:e,value:t}),t;this.ea.publish(v.CacheExpired,{key:e,value:t})}}delete(e){this.storage.delete(e),this.ea.publish(v.Clear,{key:e})}clear(){this.storage.clear(),this.T.clear(),this.ea.publish(v.Reset),this.stopBackgroundRefresh(),this.j.forEach((e=>{this.p.clearTimeout(e)})),this.j.length=0}dispose(){this.clear(),this.H.forEach((e=>e.dispose())),this.ea.publish(v.Dispose)}N(e){this.p.clearTimeout(e);const t=this.j.indexOf(e);t>-1&&this.j.splice(t,1)}}const _={cacheTime:3e5,staleTime:0,refreshStaleImmediate:!1,refreshInterval:0};class w{constructor(e){this.P=(0,i.hd)(y),this.cf={..._,...e??{}}}request(e){if(this.P.startBackgroundRefresh(this.cf.refreshInterval),"GET"!==e.method)return e;const t=this.P.get(this.key(e));return this.mark(t)??e}response(e,t){if(!t)return e;if(e.headers.has(w.cacheHeader))return e;const s=this.key(t);return this.P.setItem(s,{data:e,...this.cf},t),this.cf?.refreshStaleImmediate&&this.cf.staleTime>0&&this.P.setStaleTimer(s,this.cf.staleTime,t),e}dispose(){this.P.stopBackgroundRefresh()}key(e){return`${w.prefix}${e.url}`}mark(e){return e?.headers.set(w.cacheHeader,"hit"),e}}w.prefix="au:interceptor:",w.cacheHeader="x-au-fetch-cache";class S{constructor(){this.cache=(0,i.hd)(i.r_).globalThis.indexedDB,this.getStore=()=>this.database.transaction(S.cacheName,"readwrite").objectStore(S.cacheName),this.delete=e=>{this.getStore().delete(e)},this.has=e=>this.getStore().count(e).result>0,this.set=(e,t)=>this.getStore().put(t,e),this.get=e=>this.getStore().get(e).result,this.clear=()=>{const e=this.getStore();e.getAllKeys().result.forEach((t=>{e.delete(t)}))},this.database=this.cache.open(S.cacheName).result}}S.cacheName="au-cache";const R=Object.freeze({fixed:0,incremental:1,exponential:2,random:3}),T={maxRetries:3,interval:1e3,strategy:R.fixed};class O{constructor(e){if(this.p=(0,i.hd)(i.r_),this.retryConfig={...T,...e??{}},this.retryConfig.strategy===R.exponential&&this.retryConfig.interval<=1e3)throw d(5007,this.retryConfig.interval)}request(e){return e.retryConfig||(e.retryConfig={...this.retryConfig},e.retryConfig.counter=0),e.retryConfig.requestClone=e.clone(),e}response(e,t){return delete t.retryConfig,e}responseError(e,t,s){const{retryConfig:i}=t,{requestClone:o}=i;return Promise.resolve().then((()=>{if(i.counter<i.maxRetries){const a=null==i.doRetry||i.doRetry(e,t);return Promise.resolve(a).then((a=>{if(a){i.counter++;const e=function(e){const{interval:t,strategy:s,minRandomInterval:i,maxRandomInterval:o,counter:a}=e;if("function"==typeof s)return e.strategy(a);switch(s){case R.fixed:return k[R.fixed](t);case R.incremental:return k[R.incremental](a,t);case R.exponential:return k[R.exponential](a,t);case R.random:return k[R.random](a,t,i,o);default:throw d(5008,s)}}(i);return new Promise((t=>this.p.setTimeout(t,isNaN(e)?0:e))).then((()=>{const e=o.clone();return"function"==typeof i.beforeRetry?i.beforeRetry(e,s):e})).then((e=>{const t={...e,retryConfig:i};return s.fetch(t)}))}throw delete t.retryConfig,e}))}throw delete t.retryConfig,e}))}}const k=[e=>e,(e,t)=>t*e,(e,t)=>1===e?t:t**e/1e3,(e,t,s=0,i=6e4)=>Math.random()*(i-s)+s]}}]);