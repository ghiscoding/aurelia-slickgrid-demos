"use strict";(self.webpackChunkau_slickgrid_demo=self.webpackChunkau_slickgrid_demo||[]).push([[9457],{79457(t,e,i){i.d(e,{T:()=>d});var o=i(6221),s=i(40296),l=i(21322);const n=["title","data-slick-tooltip"],r="[title], [data-slick-tooltip]";class d{constructor(){this.name="CustomTooltip",this._cellType="slick-cell",this._rxjs=null,this._sharedService=null,this._hasMultipleTooltips=!1,this._defaultOptions={bodyClassName:"tooltip-body",className:"",offsetLeft:0,offsetRight:0,offsetTopBottom:2,regularTooltipWhiteSpace:"pre-line",whiteSpace:"normal",autoHideDelay:3e3,persistOnHover:!0},this._isMouseOverTooltip=!1,this._bindEventService=new o.P,this._eventHandler=new s.JD8}get addonOptions(){return this._addonOptions}get cancellablePromise(){return this._cancellablePromise}get cellAddonOptions(){return this._cellAddonOptions}get bodyClassName(){return this._cellAddonOptions?.bodyClassName??"tooltip-body"}get className(){let t="slick-custom-tooltip";return this._addonOptions?.className&&(t+=` ${this._addonOptions.className}`),t}get dataView(){return this._grid.getData()||{}}get gridOptions(){return this._grid?.getOptions()||{}}get gridUid(){return this._grid?.getUID()||""}get gridUidSelector(){return this.gridUid?`.${this.gridUid}`:""}get tooltipElm(){return this._tooltipElm}addRxJsResource(t){this._rxjs=t}init(t,e){this._grid=t,this._rxjs=e.get("RxJsFacade"),this._sharedService=e.get("SharedService"),this._addonOptions={...this._defaultOptions,...this._sharedService?.gridOptions?.customTooltip},this._eventHandler.subscribe(t.onMouseEnter,this.handleOnMouseOver.bind(this)).subscribe(t.onHeaderMouseOver,((t,e)=>this.handleOnHeaderMouseOverByType(t,e,"slick-header-column"))).subscribe(t.onHeaderRowMouseEnter,((t,e)=>this.handleOnHeaderMouseOverByType(t,e,"slick-headerrow-column"))).subscribe(t.onHeaderRowMouseOver,((t,e)=>this.handleOnHeaderMouseOverByType(t,e,"slick-headerrow-column"))).subscribe(t.onMouseLeave,this.handleOnMouseLeave.bind(this)).subscribe(t.onHeaderMouseOut,this.handleOnMouseLeave.bind(this)).subscribe(t.onHeaderRowMouseLeave,this.handleOnMouseLeave.bind(this)).subscribe(t.onHeaderRowMouseOut,this.handleOnMouseLeave.bind(this))}dispose(){this.hideTooltip(),this._cancellablePromise=void 0,this._eventHandler.unsubscribeAll()}handleOnMouseLeave(){!1===this.addonOptions?.persistOnHover?(this._hideTooltipTimeout&&clearTimeout(this._hideTooltipTimeout),this._hideTooltipTimeout=setTimeout((()=>{this._isMouseOverTooltip||this.hideTooltip()}),100)):this.hideTooltip()}hideTooltip(){this._cancellablePromise?.cancel(),this._observable$?.unsubscribe(),!1===this.addonOptions?.persistOnHover&&(this._hideTooltipTimeout&&(clearTimeout(this._hideTooltipTimeout),this._hideTooltipTimeout=void 0),this._autoHideTimeout&&(clearTimeout(this._autoHideTimeout),this._autoHideTimeout=void 0),this._isMouseOverTooltip=!1,this._bindEventService.unbindAll());const t=(0,l.classNameToList)(this.className).join("."),e=document.body.querySelector(`.${t}${this.gridUidSelector}`);e?.remove()}getOptions(){return this._addonOptions}setOptions(t){this._addonOptions={...this._addonOptions,...t}}asyncProcessCallback(t,e,i,o,s){this.hideTooltip();const l={...s,[this.addonOptions?.asyncParamsPropName??"__params"]:t};this._cellAddonOptions?.useRegularTooltip?this.renderRegularTooltip(this._cellAddonOptions.asyncPostFormatter,e,i,o,l):this.renderTooltipFormatter(this._cellAddonOptions.asyncPostFormatter,e,i,o,l)}handleOnHeaderMouseOverByType(t,e,i){this._cellType=i,this._mouseTarget=t.target?.closest(r),this.hideTooltip();const o={row:-1,cell:this._grid.getColumns().findIndex((t=>(e?.column?.id??"")===t.id))},s=e.column,l={},n="slick-headerrow-column"===i;if(e||={},e.cell=o.cell,e.row=o.row,e.columnDef=s,e.dataContext=l,e.grid=this._grid,e.type=n?"header-row":"header",this._cellAddonOptions={...this._addonOptions,...s?.customTooltip},!s?.disableTooltip&&("function"!=typeof this._cellAddonOptions?.usabilityOverride||this._cellAddonOptions.usabilityOverride(e))&&s&&t.target){this._cellNodeElm=t.target.closest(`.${i}`);const e=n?this._cellAddonOptions.headerRowFormatter:this._cellAddonOptions.headerFormatter;if(this._cellAddonOptions?.useRegularTooltip||!e){const t=n?this._cellAddonOptions?.useRegularTooltip?null:e:s.name;this.renderRegularTooltip(t,o,null,s,l)}else this._cellNodeElm&&"function"==typeof e&&this.renderTooltipFormatter(e,o,null,s,l)}}async handleOnMouseOver(t){if(this._cellType="slick-cell",this._mouseTarget=t.target?.closest(r),this.hideTooltip(),t&&this._grid){const e=t?.target?.closest(".slick-cell")?.className,i=e&&/l\d+/.exec(e||"")?this._grid.getCellFromEvent(t):null;if(i){const t=this.dataView?this.dataView.getItem(i.row):this._grid.getDataItem(i.row),e=this._grid.getColumns()[i.cell];if(this._cellNodeElm=this._grid.getCellNode(i.row,i.cell),t&&e){if(this._cellAddonOptions={...this._addonOptions,...e?.customTooltip},e?.disableTooltip||"function"==typeof this._cellAddonOptions?.usabilityOverride&&!this._cellAddonOptions.usabilityOverride({cell:i.cell,row:i.row,dataContext:t,column:e,grid:this._grid,type:"cell"}))return;const o=t.hasOwnProperty(e.field)?t[e.field]:null,l=this._grid.getEditorLock().isActive()?null:o;if(this._cellAddonOptions.useRegularTooltip&&!this._cellAddonOptions?.asyncProcess||!this._cellAddonOptions?.formatter)this.renderRegularTooltip(e.formatter,i,l,e,t);else if("function"==typeof this._cellAddonOptions?.formatter&&this.renderTooltipFormatter(this._cellAddonOptions.formatter,i,l,e,t),"function"==typeof this._cellAddonOptions?.asyncProcess){const l=this._cellAddonOptions.asyncProcess(i.row,i.cell,o,e,t,this._grid);if(this._cellAddonOptions.asyncPostFormatter||console.error('[Slickgrid-Universal] when using "asyncProcess" with Custom Tooltip, you must also provide an "asyncPostFormatter" formatter.'),l instanceof Promise)this._cancellablePromise=(0,s.oCj)(l),this._cancellablePromise.promise.then((s=>this.asyncProcessCallback(s,i,o,e,t))).catch((t=>{t instanceof s.J2I||console.error(t)}));else if(this._rxjs?.isObservable(l)){const s=this._rxjs;this._observable$=l.pipe(s.switchMap((t=>s.of(t)))).subscribe((s=>this.asyncProcessCallback(s,i,o,e,t)),(t=>console.error(t)))}}}}}}parseFormatterAndSanitize(t,e,i,o,s){if("function"==typeof t){const n=t(e.row,e.cell,i,o,s,this._grid),r=(0,l.isPrimitiveOrHTML)(n)?n:n.html||n.text;return this._grid.sanitizeHtmlString((r instanceof HTMLElement?r.textContent:r)||"")}return"string"==typeof t?this._grid.sanitizeHtmlString(t):""}renderRegularTooltip(t,e,i,o,l){const d=document.createElement("div");let h;(0,s.vJc)(d,this.parseFormatterAndSanitize(t,e,i,o,l),this.gridOptions),this._hasMultipleTooltips=(this._cellNodeElm?.querySelectorAll(r).length||0)>1;const a=this._cellAddonOptions?.useRegularTooltipFromCellTextOnly||!this._mouseTarget?this._cellNodeElm:this._mouseTarget;let c=o?.toolTip??"";c||("slick-cell"===this._cellType&&a&&a.clientWidth<a.scrollWidth&&!this._cellAddonOptions?.useRegularTooltipFromFormatterOnly?(c=a.textContent?.trim()??"",this._cellAddonOptions?.tooltipTextMaxLength&&c.length>this._cellAddonOptions?.tooltipTextMaxLength&&(c=c.substring(0,this._cellAddonOptions.tooltipTextMaxLength-3)+"..."),h=a):(this._cellAddonOptions?.useRegularTooltipFromFormatterOnly?h=d.querySelector(r):(h=(0,s.KI7)(a,n)?a:d.querySelector(r),h&&(0,s.KI7)(h,n)||!a||(h=a.querySelector(r))),"none"===h?.style.display||this._hasMultipleTooltips&&(!a||a===this._cellNodeElm)?c="":(!c||"function"==typeof t&&this._cellAddonOptions?.useRegularTooltipFromFormatterOnly)&&(c=(0,s.KI7)(h,n)||""))),""!==c&&this.renderTooltipFormatter(t,e,i,o,l,c,h),this.swapAndClearTitleAttribute(h,c)}renderTooltipFormatter(t,e,i,o,l,d,h){if(this._tooltipElm=(0,s.fhB)("div",{className:this.className}),this._tooltipBodyElm=(0,s.fhB)("div",{className:this.bodyClassName}),this._tooltipElm.classList.add(this.gridUid,`l${e.cell}`,`r${e.cell}`),this.tooltipElm?.appendChild(this._tooltipBodyElm),null==i){const t=this._cellNodeElm?.querySelector(r);i=(0,s.KI7)(t,n)||i}let a=d||this.parseFormatterAndSanitize(t,e,i,o,l)||"";a=this._cellAddonOptions?.tooltipTextMaxLength&&a.length>this._cellAddonOptions.tooltipTextMaxLength?a.substring(0,this._cellAddonOptions.tooltipTextMaxLength-3)+"...":a;let c="";!d||this._cellAddonOptions?.renderRegularTooltipAsHtml?(c=this._grid.sanitizeHtmlString(a),(0,s.vJc)(this._tooltipBodyElm,c,this.gridOptions),this._tooltipBodyElm.style.whiteSpace=this._cellAddonOptions?.whiteSpace??this._defaultOptions.whiteSpace):(c=a||"",this._tooltipBodyElm.textContent=c,this._tooltipBodyElm.style.whiteSpace=this._cellAddonOptions?.regularTooltipWhiteSpace??this._defaultOptions.regularTooltipWhiteSpace),this._cellAddonOptions?.maxHeight&&(this._tooltipElm.style.maxHeight=`${this._cellAddonOptions.maxHeight}px`),this._cellAddonOptions?.maxWidth&&(this._tooltipElm.style.maxWidth=`${this._cellAddonOptions.maxWidth}px`),c.toString()&&(document.body.appendChild(this._tooltipElm),!1===this.addonOptions?.persistOnHover&&(this._bindEventService.bind(this._tooltipElm,"mouseenter",(()=>{this._isMouseOverTooltip=!0,this._hideTooltipTimeout&&(clearTimeout(this._hideTooltipTimeout),this._hideTooltipTimeout=void 0)})),this._bindEventService.bind(this._tooltipElm,"mouseleave",(()=>{this._isMouseOverTooltip=!1,this.hideTooltip()})),this._autoHideTimeout=setTimeout((()=>{this.hideTooltip()}),this.addonOptions?.autoHideDelay)),this.reposition(e),this.swapAndClearTitleAttribute(h,a))}reposition(t){if(this._tooltipElm){this._cellNodeElm=this._cellNodeElm||this._grid.getCellNode(t.row,t.cell);const e=(0,s.A3q)(this._cellNodeElm),i=this._cellNodeElm.offsetWidth,o=this._tooltipElm.getBoundingClientRect().height,l=this._tooltipElm.getBoundingClientRect().width,n=document.body.offsetWidth||window.innerWidth;let r=(e.top||0)-this._tooltipElm.offsetHeight-(this._cellAddonOptions?.offsetTopBottom??0),d=(e.left||0)-(this._cellAddonOptions?.offsetRight??0);const h=this._cellAddonOptions?.position??"auto";let a="";if("center"===h?(d+=i/2-l/2+(this._cellAddonOptions?.offsetRight??0),a="top-center"):"right-align"===h||("auto"===h||"left-align"!==h)&&d+l>n?(a="right",d-=l-i-(this._cellAddonOptions?.offsetLeft??0)):a="left","bottom"===h||("auto"===h||"top"!==h)&&o>(0,s.gJz)(this._cellNodeElm).top?(r=(e.top||0)+(this.gridOptions.rowHeight??0)+(this._cellAddonOptions?.offsetTopBottom??0),a=`bottom-${a}`):a=`top-${a}`,this._tooltipElm&&(this._hasMultipleTooltips||this.cellAddonOptions?.repositionByMouseOverTarget)){const t=(0,s.A3q)(this._mouseTarget);a.includes("left")||"top-center"===a?d=t.left-3:a.includes("right")&&(d=t.left-l+(this._mouseTarget?.offsetWidth??0)+3)}this._tooltipElm.style.top=`${r}px`,this._tooltipElm.style.left=`${d}px`}}swapAndClearTitleAttribute(t,e){let i;t&&(i=this._cellNodeElm&&(this._cellNodeElm.hasAttribute("title")&&this._cellNodeElm.getAttribute("title")?this._cellNodeElm:this._cellNodeElm?.querySelector("[title]")));const o=t||this._cellNodeElm&&(this._cellNodeElm.hasAttribute("title")&&this._cellNodeElm.getAttribute("title")?this._cellNodeElm:this._cellNodeElm?.querySelector("[title]"));o&&e&&(o.setAttribute("data-slick-tooltip",e||""),o.hasAttribute("title")&&o.setAttribute("title",""),i?.hasAttribute("title")&&i.setAttribute("title",""))}}}}]);